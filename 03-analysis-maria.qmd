---
title: "Analysis"
---

Goals of this notebook: 

- What do these numbers show us about what kinds of crimes are being committed? How many are drug crimes?
- Who is being arrested?
- Who is doing the arresting?
- What kind of drugs? Is it fentanyl like Abbott says? Are most of the people getting arrested for human smuggling Black? What does the data show and why might that be? 
- Are a lot of people getting arrested in a specific backyard or area? 

## Loading up libraries 

```{r}
#| label: setup
#| message: false


library(tidyverse)
library(janitor)
library(dplyr)
library(ggplot2)
```


## Importing clean combined data, VERSA and SPURS 

```{r}
ols_data <- read_rds("data-processed/02-combine.rds")

ols_data
```

## What do these numbers show us about what kinds of crimes are being committed? How many are drug crimes?


Let's look at the different charges under the charge category: 

```{r}
ols_data$charge |> unique()
```

I want to create different categories for all the charges in the dataset.    


```{r}
cat_ols <- ols_data |>
  mutate(
    charge_cat = case_when(
      str_detect(
        charge,
        "Drug|CS|Cs|Mari|DRUG|MARI|Marj|MARJ|Man|Subs|Stash|Chem"
      ) ~ "Drug",
      str_detect(
        charge,
        "Smugg|SMUGG|Trafficking|TRAFFICKING|Trans|Bringing In"
      ) ~ "Smuggling/Trafficking of Persons",
      str_detect(charge, "Firearm|FIREARM|gun|GUN|Amm|Arm|Weapon|WEAPON") ~ "Weapon",
      str_detect(charge, "Launder|LAUNDER") ~ "Money Laundering",
      str_detect(charge, "Trespass|TRESPASS") ~ "Trespassing",
      str_detect(charge, "Alien|ALIEN|Visa|VISA|IMMIGRATION|Immigration") ~ "Immigration Other",
      str_detect(charge, "Evad|EVAD|Flee|FLEE") ~ "Evasion/Fleeing",
      str_detect(charge, "Organized|Enterprise") ~ "Organized Crime",
      str_detect(charge, "Tamp|TAMP") ~ "Tampering",
      str_detect(charge, "Unauth") ~ "Unauthorized Use of Vehicle",
      str_detect(charge, "Warrant|WARRANT") ~ "Warrant",
      str_detect(charge, "Conspiracy|CONSPIRACY") ~ "Conspiracy",
 
        .default = "Other"
       )
    
    
  )

cat_ols |>
  count(charge, charge_cat) 
  

```

Within Operation Lone Star, there are 490 different types of charges. Therefore, we decided to break down the charges into 11 different categories. Here's a key that describes each category. 

Operation Lone Star Charge Category Key: 
- Drug = Any charge that relates to possession or manufacturing of drug, as well as any drug-related charges like stash house charges. Something to note is that some charges are both  "drug/weapon" offenses.
- Weapon = Any charge relating to possession/use of unauthorized firearms or weapons. 
- Warrant/Conspiracy = General charges. 
- Smuggling/Trafficking of Persons = Human trafficking or smuggling charges. This category also includes charges for smuggling both persons and firearms. 
- Trespassing = Includes all types of trespassing charges. 
- Immigration Other = Immigration related charges. 
- Evasion/Fleeing = Escaping authority charges. 
- Organized Crime
- Tampering = Charges related to tampering with evidence. 
- Unauthorized Use of Vehicle
- Money Laundering 


Let's count per category to determine how many of these are drug crimes: 


```{r}
 cat_chart <- cat_ols |>  
  group_by(charge_cat) |> 
  summarise(charge_num =  n()) |> 
  arrange(desc(charge_num))## |> 
 # mutate(charge_num = appearances) 

cat_chart
```
 
 Note: 
 - solo drug charges that aren't fentanyl 

 Data Takeaway:
 
 - At least 23,233 charges under Operation Lone Star are drug-related. 
 - Categories include money laundering, tampering with evidence and unauthorized use of vehicle have more charges than immigration related charges. 
 
 
```{r}
#charge_cat_chart <- cat_ols |> 
ggplot(cat_chart,
       aes(x = charge_num, y =  reorder(charge_cat, charge_num))
) +
  geom_col() + 
  geom_text(aes(label = charge_num),  color = "black", position = position_dodge(width = 1)  ) +
  labs(
    title = "What is Operation Lone Star Actually Doing?",
    x = "Number of Charges", 
    y = "Charge Category", 
    subtitle = str_wrap("This chart looks at the different types of charges  under Operation Lone Star. Notably, the most popular type of charge is drug-related."), 
  caption = "Source = Operation Lone Star Data"
  )


```
 

 
 
## What kind of drugs? Is it fentanyl like Abbott says? 

Let's look at the drug charge category and break it down by type of drug. We used drug statute codes from state government (https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm) and the Drug Enforcement Agency (https://www.dea.gov/drug-information/drug-scheduling.) 


```{r}
drug_ols <- cat_ols |>
  group_by(charge) |>
  filter(charge_cat == "Drug") |>
  mutate(
    drug_type = case_when(
      str_detect(charge, "Mari|MARI|Marj|MARJ") ~ "Marijuana",
      str_detect(charge, "Fent|FENT|1-B") ~ "Fentanyl",
      str_detect(charge, "Cocaine|COCAINE") ~ "Cocaine",
      str_detect(charge, "Meth|METH") ~ "Crystal Meth",
      str_detect(charge, "1a|1-A|LSD")  ~ "LSD",
      str_detect(charge, "Heroin|HEROIN") ~ "Heroin"),
   
     default. = NA, 
    
    fentanyl = case_when(
      str_detect(charge, "Fent|FENT|1-B|Schedule Ii/") ~ "YES"),
    
    default. = NA, 
    
    marijuana = case_when(
      str_detect(charge, "Mari|MARI|Marj|MARJ|Drug Test|Schedule I/") ~ "YES"),
    
    default. = NA, 
    
    drug_weapon = case_when(
      str_detect(charge, "DRUG/WEAPON") ~ "YES"),
    
    default. = NA
  )
    
    
    
    
    
    
  
    drug_ols |>
    count(drug_type, fentanyl, marijuana, drug_weapon)

  
  

```

Originally, I tried categorizing the charges by type of drug, but this doesn't work out well because of the different codes used. So I decided to focus on any charges that could be related to fentanyl (as some are unclear) to answer our question. I also focused on marijuana charges, one of the more recurring drug offenses. Then I made a column called drug_weapon for all charges under the drug category that could also be weapons charges. 
 
NOTES: 
 
 - Poss Cs Pg = Possession of Controlled Substance in Penalty Group 
 - Fentanyl is group 1-B (any type of fentanyl)
 - Drug schedules can refer to drugs like other drugs (for example, fentanyl can be found in schedule II drugs)
 - 1-A LSD as well as any of its salts, isomers, and salts of isomers.
 - Under Sec. 481.133.  OFFENSE:  FALSIFICATION OF DRUG TEST RESULTS, can refer to failing an authorized marijuana drug test, so I noted that as "YES" under marijuana column. 

Let's count the amount of charges that can fall under fentanyl and marijuana: 

```{r}
drug_ols_analysis <- drug_ols |>
  ungroup() |>
  mutate(drug_charge = case_when(
    str_detect(fentanyl, "YES") ~ "fentanyl",
    str_detect(marijuana, "YES") ~ "marijuana",
    .default = "other"
  ))

drug_ols_analysis |>
  count(drug_charge)

```

Visualization: 

```{r}
##drug_ols_chart <- drug_ols_analysis |>
ggplot(drug_ols_analysis,
  aes(y =  drug_charge)
) +
  geom_bar() + 
  labs(
    title = "What types of drugs does Operation Lone Star target?",
    x = "Number of Charges", 
    y = "Type of Drug Charge", 
    subtitle = str_wrap("This analysis looked at fentanyl and marijuana related drug charges. Most drug charges were not related to either fentanyl or marijuana. However, drug charges are recorded differently in the data, so further anaylsis is needed to determine if this reflects the total number for each type of drug."), 
  caption = "Source = Operation Lone Star Data"
  )

 ##ggsave("figures/drug_ols_chart.png")

```

![](figures/drug_ols_chart.png)

 Data Takeaway: 
 
 - At least 1,571 charges in both OLS datasets are related to possession/manufacturing of fentanyl. This is lower than the amount of charges related to marijuana, which are at least 9,491. 
 - Overall, fentanyl charges identified in this analysis account for little over 6% of all drug charges, while marijuana charges account for little over 40% of the drug charges (from the total 23,233 drug charges identified). 
 
##Solo drug charges 
 
Now let's look at the individuals being charged for drug charges: 

```{r}
cat_ols |>
  filter(charge_cat == "Drug") |>
  count(charge_count) 
```


Data Takeaways: Most charges are solo charges. 

Now let's look at the solo charges and what drugs they are related too. 
 
```{r}
solo_drug_ols <- cat_ols |>
  group_by(charge, charge_count) |>
  filter(charge_cat == "Drug") |>
mutate(
fentanyl = case_when(
      str_detect(charge, "Fent|FENT|1-B|Schedule Ii/") ~ "YES"),
    

    marijuana = case_when(
      str_detect(charge, "Mari|MARI|Marj|MARJ|Drug Test|Schedule I/") ~ "YES"),

   
  
    default. = NA, 

) |>
  filter(charge_count == "1")

solo_drug_ols |>
count(charge, charge_count, fentanyl, marijuana)

```
 
 
 
```{r}
solo_drug_type <- 
  solo_drug_ols |>
  ungroup() |>
  mutate(drug_charge_s = case_when(
    str_detect(fentanyl, "YES") ~ "fentanyl",
    str_detect(marijuana, "YES") ~ "marijuana",
    .default = "other"
  )
)

solo_drug_type |>
  count(drug_charge_s)

```
 
Visualization: 

```{r}
ggplot(solo_drug_type,
       aes(y =  drug_charge_s)
) +
  geom_bar() + 
  labs(
    title = "What do solo drug charges look like under Operation Lone Star?",
    x = "Number of Charges", 
    y = "Type of Drug Charge", 
    subtitle = str_wrap("This analysis looked at fentanyl and marijuana related drug charges. Most drug charges were not related to either fentanyl or marijuana. However, drug charges for the same type of drug are recorded differently in the data, so further anaylsis is needed to determine if this reflects the total number for each type of drug."), 
  caption = "Source = Operation Lone Star Data"
  )
```


 
Where are solo drug charges located? 
 
```{r}
solo_drug_ols |>
  group_by(arrest_county) |>
  summarise(appearances = n()) |>
  arrange(desc(appearances))
```
 
 write it in csv: 
 
```{r}
write_csv(solo_drug_ols, "/Users/MariaProbert/rwd/solo_drug_ols.csv")
```
 


Let's look at Ector, the 6th county with the most solo drug charges. Ector county is not near the border. 
 
```{r}
solo_drug_ols |>
  mutate(
    fentanyl = case_when(
      str_detect(charge, "Fent|FENT|1-B|Schedule Ii/") ~ "YES"),
    
    default. = NA, 
    
    marijuana = case_when(
      str_detect(charge, "Mari|MARI|Marj|MARJ|Drug Test|Schedule I/") ~ "YES"),


  ) |> 

```
 

## Are most of the people getting arrested for human smuggling Black? What does the data show and why might that be?

To answer this question, lets look at the smuggling/trafficking charges and look at the offenders by race. 


```{r}
smuggle_ols <- cat_ols |>
  group_by(person_race_abbr,charge_cat) |>
  summarise(appearances = n()) |> 
  arrange(desc(appearances)) |>
  filter(charge_cat == "Smuggling/Trafficking of Persons") |>
  select(!charge_cat)

smuggle_ols
```
Key: 
- B = Black 
- H = Hispanic (if race not given, only ethnicity)
- W = White 
- A = American Indian or Alaska Native 
- U & NA = Unknown 

Data Takeaways: 

- Most people arrested for smuggling/trafficking aren't Black. Although, 1,184 of those charged with smuggling/trafficking people under Opertion Lone Star are Black making up little over 10% of charges (from smuggling category total). 
- Of those charged, the most common ethnicity (without taking into consideration race) is Hispanic, with 8,178 charges. SPURS dataset does not differentiate between ethnicity and race which might affect the results of the data. 


NEXT STEPS?: 
- Look at B charges and then look at their location... does this line up with Houston? 

## Officers in all counties 

How to filter a percentage in tabyl? 
 
```{r}
officer_count |>
  tabyl(arresting_officer, arrest_county ) |>
  adorn_totals("col", name = "col_total") |>
  adorn_totals("row") |>
  tibble() |> 
  arrange(desc(col_total)) |>
  filter(col_total > 100)
  
 

```
 
```{r}
#officer_count <- ols_data |> 
 # group_by(arresting_officer) ##|> 


ols_data |> 
  count( arresting_officer)
```

 Can we import a tableau file 
